# Nombres de archivos
TARGET = main.dynamic.exe
LIBRARY = libucsp.so
OBJECTS = ucsp.o main.o

# Reglas de compilación
all: $(TARGET)

ucsp.o: ucsp.c ucsp.h
	gcc -fPIC -c ucsp.c -o ucsp.o

# Crear la biblioteca dinámica
$(LIBRARY): ucsp.o
	gcc -shared -o $(LIBRARY) ucsp.o

# Enlazar y crear el ejecutable
# -Wl,-rpath=. evita el uso de las variables de entorno
# -Wl los argumentos deben ser separados al enlazador
# -rpath establece una ruta en el tiempode ejecucion
$(TARGET): $(OBJECTS) $(LIBRARY)
	gcc -o $(TARGET) main.c -L. -lucsp -Wl,-rpath=.

# Limpiar los archivos compilados
clean:
	rm -f $(OBJECTS) $(TARGET) $(LIBRARY)

